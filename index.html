<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AION2 BOSS Ë®àÊôÇÂô® (ÂñÆÊ©üÁâà)</title>
    
    <!-- 1. ËºâÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: { 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <style>
        /* Ëá™ÂÆöÁæ©Êç≤Ëª∏ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>

    <!-- 2. ËºâÂÖ• Babel (Áî®ÊñºËß£Êûê JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. Ë®≠ÂÆö Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0"
        }
    }
    </script>
</head>
<body class="bg-slate-900 text-slate-100">
    <div id="root"></div>

    <!-- 4. ‰∏ªÁ®ãÂºèÈÇèËºØ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { Clock, Skull, Plus, Trash2, Edit2, Save, X, RotateCcw, Swords, AlertCircle, Filter, Zap, Search, Check, Volume2, VolumeX, Download, Upload, Bot, History, ChevronRight, AlertTriangle, CloudOff, Copy } from 'lucide-react';

        // --- BOSS Ë≥áÊñô ---
        const GAME_DATA = [
            // --- Â§©Êóè (Elyos) ---
            { id: 'e1', race: 'Elyos', name: "Ë•øÂÅ¥Âá±ÂãíËæ≤", location: "ÂùéÂ°îÊñØÊ∫™Ë∞∑", intervalNormal: 60, intervalEvent: 30, image: "üê∫" },
            { id: 'e2', race: 'Elyos', name: "Êù±ÂÅ¥Ê∂ÖÂá±Áàæ", location: "ÂùéÂ°îÊñØÊ∫™Ë∞∑", intervalNormal: 60, intervalEvent: 30, image: "üê∫" },
            { id: 'e3', race: 'Elyos', name: "ËÖêÊúΩÁöÑÂ∫´Â°îÁàæ", location: "ËâæÁàæÂÄ´Ê≤≥Ê≤ºÊæ§", intervalNormal: 60, intervalEvent: 30, image: "üßü" },
            { id: 'e4', race: 'Elyos', name: "ÁõõÈñãÁöÑÊüØÊûó", location: "ËâæÁàæÂÄ´Ê≤≥‰∏≠Ê∏∏", intervalNormal: 120, intervalEvent: 60, image: "üå∫" },
            { id: 'e5', race: 'Elyos', name: "Ë≠∑Ë°õÂÖµÊèêÁîòÁâπ", location: "Ë¶ÅÂ°ûÂª¢Â¢ü", intervalNormal: 180, intervalEvent: 90, image: "üõ°Ô∏è" },
            { id: 'e6', race: 'Elyos', name: "ÁãÇÈ¨•Â£´Â∫´Ê£Æ", location: "Ë¶ÅÂ°ûÂª¢Â¢ü", intervalNormal: 240, intervalEvent: 120, image: "‚öîÔ∏è" },
            { id: 'e7', race: 'Elyos', name: "Á•≠Âè∏Èï∑Âä†ÁàæÊñ∞", location: "Ë¶ÅÂ°ûÂª¢Â¢ü", intervalNormal: 240, intervalEvent: 120, image: "üîÆ" },
            { id: 'e8', race: 'Elyos', name: "Ë°ÄÁç†ÁâôÊôÆÂØß", location: "ÊâòÁàæÂ∑¥ÊñØÊ£ÆÊûó", intervalNormal: 360, intervalEvent: 180, image: "ü¶∑" },
            { id: 'e9', race: 'Elyos', name: "ÊÜ§ÊÄíÁöÑËñ©ÂëÇ", location: "ÊâòÁàæÂ∑¥ÊñØÊ£ÆÊûó", intervalNormal: 360, intervalEvent: 180, image: "üò°" },
            { id: 'e10', race: 'Elyos', name: "Â≠∏ËÄÖÊãâÂÖÄÊãâ", location: "ÈòøÁàæÊãâÁÉèÈÉ®ËêΩ", intervalNormal: 240, intervalEvent: 120, image: "üìú" },
            { id: 'e11', race: 'Elyos', name: "ËøΩÊìäËÄÖÂ°îÂÖÄÁæÖ", location: "ÈòøÁàæÊãâÁÉèÈÉ®ËêΩ", intervalNormal: 240, intervalEvent: 120, image: "üèÉ" },
            { id: 'e12', race: 'Elyos', name: "Ê£ÆÊûóÊà∞Â£´ÁÉèÂâåÂßÜ", location: "ÈòøÁàæÊãâÁÉèÈÉ®ËêΩ", intervalNormal: 480, intervalEvent: 240, image: "üå≥" },
            { id: 'e13', race: 'Elyos', name: "ÈªëËâ≤Ëß∏ÊâãÊãâÁì¶", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÂ≥ΩË∞∑", intervalNormal: 480, intervalEvent: 240, image: "ü¶ë" },
            { id: 'e14', race: 'Elyos', name: "ÂèõÊïôËÄÖÈõ∑Êãâ", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÈ´òÂéü", intervalNormal: 360, intervalEvent: 180, image: "üë∫" },
            { id: 'e15', race: 'Elyos', name: "ÁôæÂ§´Èï∑Êà¥Á±≥ÁæÖÊñØ", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÈ´òÂéü", intervalNormal: 480, intervalEvent: 240, image: "üëÆ" },
            { id: 'e16', race: 'Elyos', name: "Á•ûËÅñÁöÑÂÆâËñ©ÊñØ", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÈ´òÂéü", intervalNormal: 720, intervalEvent: 360, image: "‚ú®" },
            { id: 'e17', race: 'Elyos', name: "Ê≤âÈªòÂ°îÁàæÂù¶", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÈ´òÂéüÂçóÈÉ®", intervalNormal: 720, intervalEvent: 360, image: "üò∂" },
            { id: 'e18', race: 'Elyos', name: "ÈùàÈ≠ÇÊîØÈÖçËÄÖÂç°Ê≤ôÂ∏ï", location: "ÈòøÁàæÂ°îÁ±≥‰∫ûÈ´òÂéüÊù±ÈÉ®", intervalNormal: 720, intervalEvent: 360, image: "üëª" },
            { id: 'e19', race: 'Elyos', name: "Êî∂Á©´ÁÆ°ÁêÜËÄÖËé´Â§èÂ§´", location: "Âæ∑ÊãâÈÇ£Ê†ΩÂüπÂú∞", intervalNormal: 360, intervalEvent: 180, image: "üåæ" },
            { id: 'e20', race: 'Elyos', name: "Áõ£Ë¶ñÂÖµÂô®ÂÖãÁ¥çË®±", location: "Âæ∑ÊãâÈÇ£Ê†ΩÂüπÂú∞", intervalNormal: 480, intervalEvent: 240, image: "üëÅÔ∏è" },
            { id: 'e21', race: 'Elyos', name: "Á†îÁ©∂ÂÆòÂ°ûÁâπËò≠", location: "Á¥çÂ∏åÂæ∑ËªçÂúòË¶ÅÂ°û", intervalNormal: 720, intervalEvent: 360, image: "üß™" },
            { id: 'e22', race: 'Elyos', name: "ÂπªÂ§¢Âç°Ë•ø‰∫û", location: "ÂπªÂΩ±Á•ûÂ∫≠Èô¢", intervalNormal: 720, intervalEvent: 360, image: "ü¶ã" },
            { id: 'e23', race: 'Elyos', name: "ËªçÂúòÈï∑ÊãâÊ†ºÂ°î", location: "Á¥ÖËâ≤Ê£ÆÊûó", intervalNormal: 1440, intervalEvent: 720, image: "üëë" },
            { id: 'e24', race: 'Elyos', name: "Ê∞∏ÊÅÜÂç°ÁàæÂêê‰∫û", location: "Ê∞∏ÊÅÜ‰πãÂ≥∂", intervalNormal: 1440, intervalEvent: 720, image: "üèùÔ∏è" },

            // --- È≠îÊóè (Asmodian) ---
            { id: 'a1', race: 'Asmodian', name: "ËûçÂåñÁöÑÈÅîÁ¥çÊ®Ç", location: "Âæ∑Èõ∑ÂæóÂ•áÂÆâÂ§±‰∫ãÂú∞", intervalNormal: 60, intervalEvent: 30, image: "ü´†" },
            { id: 'a2', race: 'Asmodian', name: "ÈªëËâ≤Êà∞Â£´ÈòøÂüÉÂæ∑", location: "ÁÑ°ÂêçÂ¢ìÂú∞", intervalNormal: 60, intervalEvent: 30, image: "‚öîÔ∏è" },
            { id: 'a3', race: 'Asmodian', name: "Âø†ÂØ¶ÁöÑÊãâÂêâÁâπ", location: "ËÅñÊâÄÁõ£Ë¶ñÂì®ÊâÄ", intervalNormal: 60, intervalEvent: 30, image: "üêï" },
            { id: 'a4', race: 'Asmodian', name: "ÁãÇÊà∞Â£´Áì¶Ê†º", location: "ËÅñÊâÄÁõ£Ë¶ñÂì®ÊâÄ", intervalNormal: 120, intervalEvent: 60, image: "üë∫" },
            { id: 'a5', race: 'Asmodian', name: "Ë°ÄÊà∞Â£´Ëò≠ÈÇ£Áàæ", location: "Áë™ÊñØËò≠Ê£ÆÊûó", intervalNormal: 180, intervalEvent: 90, image: "ü©∏" },
            { id: 'a6', race: 'Asmodian', name: "ÊçïÈ£üËÄÖÂä†ÁàæÊ°ë", location: "Áë™ÊñØËò≠Ê£ÆÊûó", intervalNormal: 240, intervalEvent: 120, image: "üêÖ" },
            { id: 'a7', race: 'Asmodian', name: "Ê¨∫ÁûûËÄÖÁâπÈáåÂæ∑", location: "ÁÉèÁàæÈÄöÊµ∑ÂßÜ", intervalNormal: 240, intervalEvent: 120, image: "ü§•" },
            { id: 'a8', race: 'Asmodian', name: "ËóçËâ≤Ê∞¥Ê≥¢Âá±ÂåπÈÇ£", location: "Ê∑®Âåñ‰πãÊ£Æ", intervalNormal: 240, intervalEvent: 120, image: "üåä" },
            { id: 'a9', race: 'Asmodian', name: "Ê≤âÈªòÂ°îÁàæÂù¶", location: "Ê∑®Âåñ‰πãÊ£Æ", intervalNormal: 720, intervalEvent: 360, image: "üò∂" },
            { id: 'a10', race: 'Asmodian', name: "ÂèÉË¨ÄÂÆòÂãíÊ≤ôÁ¥ç", location: "Âæ∑ÊãâÈÇ£ÂÖãÂúñÊñØ", intervalNormal: 360, intervalEvent: 180, image: "üìù" },
            { id: 'a11', race: 'Asmodian', name: "Á∏ΩÁõ£Áù£ÂÆòÂä™Â°î", location: "Âæ∑ÊãâÈÇ£ÂÖãÂúñÊñØ", intervalNormal: 240, intervalEvent: 120, image: "üëÄ" },
            { id: 'a12', race: 'Asmodian', name: "Âà•ÂãïÈöäÈï∑‰ª§ÂÖãÊñØ", location: "Â∑¥ÊñØÊñêÁàæÁâπÂª¢Â¢ü", intervalNormal: 360, intervalEvent: 180, image: "ü´°" },
            { id: 'a13', race: 'Asmodian', name: "Ë§ªÁÄÜËÄÖË´æÂ∏ÉÈ≠ØÂæ∑", location: "Â∑¥ÊñØÊñêÁàæÁâπÂª¢Â¢ü", intervalNormal: 480, intervalEvent: 240, image: "üï∏Ô∏è" },
            { id: 'a14', race: 'Asmodian', name: "‰∫°È≠ÇÂü∑ÊîøÂÆò‰∫ûÂÖãÂ∏≠Ê≠êÊñØ", location: "Â∑¥ÊñØÊñêÁàæÁâπÂª¢Â¢ü", intervalNormal: 480, intervalEvent: 240, image: "üëª" },
            { id: 'a15', race: 'Asmodian', name: "‰∏≠ÊØíÁöÑÂìàËø™ÂÄ´", location: "Ê≥ïÂ§´Â•àÁâπÂüãËóèÂú∞", intervalNormal: 360, intervalEvent: 180, image: "‚ò†Ô∏è" },
            { id: 'a16', race: 'Asmodian', name: "ÈùàÈ≠ÇÊîØÈÖçËÄÖÂç°Ê≤ôÂ∏ï", location: "Ê≥ïÂ§´Â•àÁâπÂüãËóèÂú∞", intervalNormal: 720, intervalEvent: 360, image: "üëª" },
            { id: 'a17', race: 'Asmodian', name: "ËôïÂàëËÄÖÂ∑¥ÁàæË•øÊÅ©", location: "ËëõÂà©Â∑¥Âæ∑Â≥ΩË∞∑Ë•øÈÉ®", intervalNormal: 480, intervalEvent: 240, image: "ü™ì" },
            { id: 'a18', race: 'Asmodian', name: "ÈÉ®ÈöäÂÖµÂô®Âè§È≠ØÂ°î", location: "ËëõÂà©Â∑¥Âæ∑Â≥ΩË∞∑Êù±ÈÉ®", intervalNormal: 720, intervalEvent: 360, image: "ü§ñ" },
            { id: 'a19', race: 'Asmodian', name: "ÁôæÊà∞ËÄÅÂ∞áËàíÊú≠Âùé", location: "ÈªëÁà™ÈÉ®ËêΩ", intervalNormal: 360, intervalEvent: 180, image: "üë¥" },
            { id: 'a20', race: 'Asmodian', name: "Á•ïÂÇ≥Âç°È≠ØÂç°", location: "ÈªëÁà™ÈÉ®ËêΩ", intervalNormal: 480, intervalEvent: 240, image: "ü§ê" },
            { id: 'a21', race: 'Asmodian', name: "ÈªëÈóáÊØî‰øÆË≤ùÈÅî", location: "ÊãâÊ†ºÂ°îË¶ÅÂ°û", intervalNormal: 720, intervalEvent: 360, image: "üåë" },
            { id: 'a22', race: 'Asmodian', name: "ËªçÂúòÈï∑ÊãâÊ†ºÂ°î", location: "ÊãâÊ†ºÂ°îË¶ÅÂ°û", intervalNormal: 1440, intervalEvent: 720, image: "üëë" },
            { id: 'a23', race: 'Asmodian', name: "ÊïèÈä≥ÁöÑÊïòÊãâÂÖã", location: "Âõ†Ê¥æÂúñË•øÂßÜÂª£Â†¥", intervalNormal: 720, intervalEvent: 360, image: "üêÄ" },
            { id: 'a24', race: 'Asmodian', name: "‰∏çÊªÖÂç°ÁàæÂêê‰∫û", location: "‰∏çÊªÖ‰πãÂ≥∂", intervalNormal: 1440, intervalEvent: 720, image: "üèùÔ∏è" },

            // --- Ê∑±Ê∑µ (Abyss) ---
            { id: 'ab1', race: 'Abyss', name: "Áõ£Ë¶ñËÄÖÂç°‰ºäÊãâ", location: "ËâæÈõ∑‰øÆËóçÂ°î‰∏ãÂ±§", intervalNormal: 60, intervalEvent: 60, image: "üëÅÔ∏è" },
            { id: 'ab2', race: 'Abyss', name: "Á≤æÈùàÁéãÈòøÊ†ºÁæÖ", location: "Â∏åÂüÉÁàæ‰πãÁøºÁæ§Â≥∂", intervalNormal: 1440, intervalEvent: 720, image: "üßö" },
        ];

        const INITIAL_BOSSES = GAME_DATA.map(boss => ({
            ...boss,
            nextSpawn: null,
            lastKill: null
        }));

        function App() {
            const [bosses, setBosses] = useState(() => {
                const saved = localStorage.getItem('aion2-bosses-v2');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    return INITIAL_BOSSES.map(initBoss => {
                        const savedBoss = parsed.find(p => p.id === initBoss.id);
                        return savedBoss ? { ...initBoss, nextSpawn: savedBoss.nextSpawn, lastKill: savedBoss.lastKill } : initBoss;
                    });
                }
                return INITIAL_BOSSES;
            });

            // State
            const [currentTime, setCurrentTime] = useState(Date.now());
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingBoss, setEditingBoss] = useState(null);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, type: 'confirm', message: '', onConfirm: null });

            // Settings
            const [isEventMode, setIsEventMode] = useState(() => localStorage.getItem('aion2-event-mode') === 'true');
            const [isSoundEnabled, setIsSoundEnabled] = useState(() => localStorage.getItem('aion2-sound-enabled') !== 'false');
            const [isAutoKillEnabled, setIsAutoKillEnabled] = useState(() => localStorage.getItem('aion2-auto-kill') === 'true');
            
            // UI
            const [ignoredEvents, setIgnoredEvents] = useState({});
            const [selectedRaces, setSelectedRaces] = useState(['Elyos', 'Asmodian', 'Abyss']); 
            const [searchQuery, setSearchQuery] = useState('');
            const [formData, setFormData] = useState({ name: '', location: '', intervalNormal: 60, intervalEvent: 30, image: 'üíÄ', race: 'Elyos' });

            const fileInputRef = useRef(null);
            const alertedSpawnsRef = useRef(new Map());

            // Helper to update state AND local
            const updateBosses = (newBosses) => {
                setBosses(newBosses);
                localStorage.setItem('aion2-bosses-v2', JSON.stringify(newBosses));
            };

            const updateEventMode = (newMode) => {
                setIsEventMode(newMode);
                localStorage.setItem('aion2-event-mode', newMode);
            };

            // --- Local Persistence ---
            useEffect(() => {
                localStorage.setItem('aion2-sound-enabled', isSoundEnabled);
                localStorage.setItem('aion2-auto-kill', isAutoKillEnabled);
            }, [isSoundEnabled, isAutoKillEnabled]);


            // --- Timer & Logic ---

            // Êí≠ÊîæÊèêÁ§∫Èü≥
            const playAlertSound = () => {
                if (!isSoundEnabled) return;
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (!AudioContext) return;
                    const ctx = new AudioContext();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, ctx.currentTime);
                    osc.frequency.setValueAtTime(587.33, ctx.currentTime + 0.15);
                    
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    
                    osc.start();
                    osc.stop(ctx.currentTime + 0.6);
                } catch (e) {
                    console.error("Audio play failed", e);
                }
            };

            const getInterval = (boss) => isEventMode ? boss.intervalEvent : boss.intervalNormal;

            // Main Loop
            useEffect(() => {
                const timer = setInterval(() => {
                    const now = Date.now();
                    setCurrentTime(now);

                    // 1. Èü≥ÊïàÊ™¢Êü•
                    if (isSoundEnabled) {
                        bosses.forEach(boss => {
                            if (boss.nextSpawn) {
                                const timeLeft = boss.nextSpawn - now;
                                if (timeLeft <= 180000 && timeLeft > 178000) {
                                    const lastAlerted = alertedSpawnsRef.current.get(boss.id);
                                    if (lastAlerted !== boss.nextSpawn) {
                                        playAlertSound();
                                        alertedSpawnsRef.current.set(boss.id, boss.nextSpawn);
                                    }
                                }
                            }
                        });
                    }

                    // 2. Ëá™ÂãïÊìäÊÆ∫ÈÇèËºØ
                    if (isAutoKillEnabled) {
                        let hasChanges = false;
                        const newBosses = bosses.map(boss => {
                            if (boss.nextSpawn && now > boss.nextSpawn + 15000) {
                                hasChanges = true;
                                const interval = isEventMode ? boss.intervalEvent : boss.intervalNormal;
                                const newLastKill = boss.nextSpawn;
                                const newNextSpawn = newLastKill + (interval * 60 * 1000);

                                return { 
                                    ...boss, 
                                    lastKill: newLastKill, 
                                    nextSpawn: newNextSpawn,
                                    killType: 'auto' 
                                };
                            }
                            return boss;
                        });
                        
                        if (hasChanges) {
                            updateBosses(newBosses);
                        }
                    }

                }, 1000);
                return () => clearInterval(timer);
            }, [bosses, isSoundEnabled, isAutoKillEnabled, isEventMode]); 

            // --- Handlers ---

            const showConfirm = (message, onConfirm) => {
                setConfirmModal({ isOpen: true, type: 'confirm', message, onConfirm });
            };
            
            const showAlert = (message) => {
                setConfirmModal({ isOpen: true, type: 'alert', message, onConfirm: () => setConfirmModal(prev => ({...prev, isOpen: false})) });
            };

            const handleKill = (id) => {
                const now = Date.now();
                const newBosses = bosses.map(boss => {
                    if (boss.id === id) {
                        const interval = isEventMode ? boss.intervalEvent : boss.intervalNormal;
                        return {
                            ...boss,
                            lastKill: now,
                            nextSpawn: now + (interval * 60 * 1000),
                            killType: 'manual'
                        };
                    }
                    return boss;
                });
                updateBosses(newBosses);
            };

            const handleQuickTimeInput = (id, e) => {
                if (e.type === 'keydown' && e.key !== 'Enter') return;
                const value = e.target.value.trim();
                if (!value) return;

                const cleanVal = value.replace(/[^0-9]/g, '');
                if (!/^[0-9]{3,6}$/.test(cleanVal)) return;

                let hours, minutes, seconds = 0;
                if (cleanVal.length === 3) { hours = parseInt(cleanVal.substring(0, 1)); minutes = parseInt(cleanVal.substring(1, 3)); }
                else if (cleanVal.length === 4) { hours = parseInt(cleanVal.substring(0, 2)); minutes = parseInt(cleanVal.substring(2, 4)); }
                else if (cleanVal.length === 5) { hours = parseInt(cleanVal.substring(0, 1)); minutes = parseInt(cleanVal.substring(1, 3)); seconds = parseInt(cleanVal.substring(3, 5)); }
                else { hours = parseInt(cleanVal.substring(0, 2)); minutes = parseInt(cleanVal.substring(2, 4)); seconds = parseInt(cleanVal.substring(4, 6)); }

                if (hours < 0 || hours > 23 || minutes < 0 || minutes > 59 || seconds < 0 || seconds > 59) {
                    showAlert("ÊôÇÈñìÊ†ºÂºèÈåØË™§");
                    e.target.value = '';
                    return;
                }

                const now = new Date();
                const killDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, seconds);
                const killTime = killDate.getTime();
                
                const newBosses = bosses.map(boss => {
                    if (boss.id === id) {
                        const interval = isEventMode ? boss.intervalEvent : boss.intervalNormal;
                        return { ...boss, lastKill: killTime, nextSpawn: killTime + (interval * 60 * 1000), killType: 'manual' };
                    }
                    return boss;
                });
                updateBosses(newBosses);
                
                e.target.value = '';
                if(e.type === 'keydown') e.target.blur();
            };

            const handleReset = (id) => {
                showConfirm("Á¢∫ÂÆöË¶ÅÈáçÁΩÆÊ≠§ BOSS ÁöÑË®àÊôÇÂóéÔºü", () => {
                    const newBosses = bosses.map(boss => boss.id === id ? { ...boss, nextSpawn: null, lastKill: null } : boss);
                    updateBosses(newBosses);
                });
            };

            const handleRespawnAll = () => {
                showConfirm(
                    "‚ö†Ô∏è Ë≠¶ÂëäÔºöË®≠ÂÆöÁÇ∫„ÄåÂÖ®ÈÉ®ÈáçÁîü„ÄçÔºü\n\nÈÄôÈÄöÂ∏∏Áî®Êñº‰º∫ÊúçÂô®Á∂≠Ë≠∑ÈñãÊ©üÂæå„ÄÇ\nÊâÄÊúâ BOSS Â∞áÊ®ôË®òÁÇ∫„ÄåÂ∑≤ÈáçÁîü„ÄçÁãÄÊÖã„ÄÇ", 
                    () => {
                        const now = Date.now();
                        const newBosses = bosses.map(boss => ({
                            ...boss,
                            lastKill: null, 
                            nextSpawn: now, // Ë®≠ÁÇ∫ÁèæÂú®Ôºå‰ª£Ë°®ÊôÇÈñìÂà∞ÔºåÂ∑≤ÈáçÁîü
                            killType: null 
                        }));
                        updateBosses(newBosses);
                        setIgnoredEvents({}); 
                        alertedSpawnsRef.current.clear(); 
                    }
                );
            };

            const handleDelete = (id) => {
                showConfirm("Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ BOSS Ë≥áÊñôÂóéÔºü", () => {
                    const newBosses = bosses.filter(b => b.id !== id);
                    updateBosses(newBosses);
                });
            };

            // UI Helpers
            const toggleRace = (race) => setSelectedRaces(prev => prev.includes(race) ? prev.filter(r => r !== race) : [...prev, race]);
            const selectAllRaces = () => setSelectedRaces(['Elyos', 'Asmodian', 'Abyss']);
            const handleIgnoreRecent = (boss) => {
                const isSpawned = boss.nextSpawn && boss.nextSpawn <= currentTime;
                const targetTime = isSpawned ? boss.nextSpawn : boss.lastKill;
                if (targetTime) setIgnoredEvents(prev => ({ ...prev, [boss.id]: targetTime }));
            };
            const handleIgnoreAllRecent = () => {
                showConfirm("Á¢∫ÂÆöË¶ÅÂøΩÁï•ÁõÆÂâçÊâÄÊúâÈÄöÁü•ÂóéÔºü", () => {
                    const newIgnored = {};
                    recentBosses.forEach(b => {
                        const isSpawned = b.nextSpawn && b.nextSpawn <= currentTime;
                        const targetTime = isSpawned ? b.nextSpawn : b.lastKill;
                        if (targetTime) newIgnored[b.id] = targetTime;
                    });
                    setIgnoredEvents(prev => ({ ...prev, ...newIgnored }));
                });
            };

            // Data Filtering
            const recentBosses = bosses.filter(b => {
                const isSpawned = b.nextSpawn && b.nextSpawn <= currentTime;
                const isAutoKilledRecently = b.lastKill && (currentTime - b.lastKill < 5 * 60 * 1000) && b.killType === 'auto';
                if (!isSpawned && !isAutoKilledRecently) return false;
                const relevantTime = isSpawned ? b.nextSpawn : b.lastKill;
                if (ignoredEvents[b.id] === relevantTime) return false;
                return true;
            }).sort((a, b) => {
                const aSpawned = a.nextSpawn <= currentTime;
                const bSpawned = b.nextSpawn <= currentTime;
                if (aSpawned && !bSpawned) return -1;
                if (!aSpawned && bSpawned) return 1;
                const timeA = aSpawned ? a.nextSpawn : a.lastKill;
                const timeB = bSpawned ? b.nextSpawn : b.lastKill;
                return timeB - timeA;
            });

            const filteredBosses = bosses.filter(boss => {
                const raceMatch = selectedRaces.includes(boss.race);
                const searchMatch = !searchQuery || 
                    boss.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                    boss.location.toLowerCase().includes(searchQuery.toLowerCase());
                return raceMatch && searchMatch;
            });

            const sortedBosses = [...filteredBosses].sort((a, b) => {
                if (!a.nextSpawn && !b.nextSpawn) return a.id.toString().localeCompare(b.id.toString());
                if (!a.nextSpawn) return 1;
                if (!b.nextSpawn) return -1;
                if (a.nextSpawn === b.nextSpawn) return a.id.toString().localeCompare(b.id.toString());
                return a.nextSpawn - b.nextSpawn;
            });

            // Modal handlers for Boss Editing
            const openModal = (boss = null) => {
                if (boss) {
                    setEditingBoss(boss);
                    setFormData({ name: boss.name, location: boss.location, intervalNormal: boss.intervalNormal, intervalEvent: boss.intervalEvent || boss.intervalNormal, image: boss.image || 'üíÄ', race: boss.race || 'Elyos' });
                } else {
                    setEditingBoss(null);
                    setFormData({ name: '', location: '', intervalNormal: 60, intervalEvent: 30, image: 'üíÄ', race: 'Elyos' });
                }
                setIsModalOpen(true);
            };

            const handleSaveBoss = (e) => {
                e.preventDefault();
                if (editingBoss) {
                    const newBosses = bosses.map(b => {
                        if (b.id === editingBoss.id) {
                            const newBossData = { ...b, ...formData, id: b.id };
                            if (newBossData.lastKill) {
                                const interval = isEventMode ? newBossData.intervalEvent : newBossData.intervalNormal;
                                newBossData.nextSpawn = newBossData.lastKill + (interval * 60 * 1000);
                            }
                            return newBossData;
                        }
                        return b;
                    });
                    updateBosses(newBosses);
                } else {
                    const newBosses = [...bosses, { ...formData, id: Date.now(), nextSpawn: null, lastKill: null }];
                    updateBosses(newBosses);
                }
                setIsModalOpen(false);
            };

            // Export/Import
            const handleExport = () => {
                const dataToSave = { version: '2.0', timestamp: Date.now(), bosses, isEventMode, isSoundEnabled, isAutoKillEnabled };
                const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `aion2-backup.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
            };
            const handleImportClick = () => fileInputRef.current?.click();
            const handleFileChange = (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (!Array.isArray(importedData.bosses)) throw new Error("Ê†ºÂºèÈåØË™§");
                        showConfirm(`Á¢∫ÂÆöÂåØÂÖ• ${importedData.bosses.length} Á≠ÜË≥áÊñôÔºü`, () => {
                            updateBosses(importedData.bosses);
                            if (typeof importedData.isEventMode === 'boolean') updateEventMode(importedData.isEventMode);
                            showAlert("ÂåØÂÖ•ÊàêÂäüÔºÅ");
                        });
                    } catch (err) { showAlert("ÂåØÂÖ•Â§±Êïó"); }
                    e.target.value = '';
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-screen bg-slate-900 text-slate-100 font-sans pb-20">
                    <header className="bg-slate-800 border-b border-slate-700 sticky top-0 z-20 shadow-lg">
                        <div className="max-w-6xl mx-auto px-4 py-3">
                            <div className="flex justify-between items-center mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-indigo-600 rounded-lg shadow-lg"><Swords size={20} className="text-white" /></div>
                                    <div>
                                        <h1 className="text-lg md:text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                                            AION2 BOSS Ë®àÊôÇÂô®
                                        </h1>
                                        <p className="text-xs text-slate-400 flex items-center gap-1 font-mono">
                                            <CloudOff size={10}/> ÂñÆÊ©üÊ®°Âºè | <Clock size={10} /> {new Date(currentTime).toLocaleTimeString()}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex gap-2 items-center">
                                    <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept=".json" />
                                    <button onClick={handleImportClick} className="bg-slate-700 hover:bg-slate-600 text-slate-300 p-2 rounded-lg transition-colors shadow-md" title="ÂåØÂÖ•ÂÇô‰ªΩ"><Upload size={20} /></button>
                                    <button onClick={handleExport} className="bg-slate-700 hover:bg-slate-600 text-slate-300 p-2 rounded-lg transition-colors shadow-md" title="ÂåØÂá∫ÂÇô‰ªΩ"><Download size={20} /></button>
                                    <div className="w-[1px] h-6 bg-slate-600 mx-1"></div>
                                    <button onClick={handleRespawnAll} className="bg-slate-700 hover:bg-slate-600 text-red-400 hover:text-red-300 p-2 rounded-lg transition-colors shadow-md" title="ÂÖ®ÈÉ®ÈáçÁîü (‰º∫ÊúçÂô®ÈáçÂïü)"><RotateCcw size={20} /></button>
                                    <button onClick={() => openModal()} className="bg-slate-700 hover:bg-slate-600 text-white p-2 rounded-lg transition-colors shadow-md" title="Êñ∞Â¢û BOSS"><Plus size={20} /></button>
                                </div>
                            </div>

                            <div className="flex flex-col md:flex-row gap-3 items-center bg-slate-900/50 p-2 rounded-lg border border-slate-700/50">
                                <div className="relative w-full md:w-48">
                                    <Search size={14} className="absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-500"/>
                                    <input 
                                        type="text" 
                                        placeholder="ÊêúÂ∞ãÂêçÁ®±/Âú∞Èªû..." 
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full bg-slate-800 border-none rounded-md py-1.5 pl-8 pr-2 text-xs text-slate-200 focus:ring-1 focus:ring-indigo-500 placeholder-slate-600"
                                    />
                                </div>

                                <div className="h-4 w-[1px] bg-slate-700 hidden md:block"></div>

                                <div className="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0 no-scrollbar">
                                    <button onClick={selectAllRaces} className={`px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all border ${selectedRaces.length === 3 ? 'bg-indigo-600 text-white border-indigo-500 shadow-md' : 'bg-slate-800 text-slate-400 border-transparent hover:bg-slate-700'}`}>ÂÖ®ÈÉ®</button>
                                    {['Elyos', 'Asmodian', 'Abyss'].map(race => (
                                        <button key={race} onClick={() => toggleRace(race)} className={`px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all flex items-center gap-1.5 border ${selectedRaces.includes(race) ? 'bg-slate-700 text-white border-slate-500 shadow-sm' : 'bg-slate-800 text-slate-500 hover:bg-slate-700 border-transparent'}`}>
                                            {selectedRaces.includes(race) && <Check size={12} className="text-green-400"/>}
                                            {race === 'Elyos' ? 'Â§©Êóè' : race === 'Asmodian' ? 'È≠îÊóè' : 'Ê∑±Ê∑µ'}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex-1 hidden md:block"></div>

                                <button
                                    onClick={() => setIsAutoKillEnabled(!isAutoKillEnabled)}
                                    className={`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold transition-all border ${
                                        isAutoKillEnabled 
                                        ? 'bg-slate-700 text-rose-400 border-rose-500/30' 
                                        : 'bg-slate-800 text-slate-500 border-transparent'
                                    }`}
                                    title={isAutoKillEnabled ? "Ëá™ÂãïÊìäÊÆ∫Â∑≤ÈñãÂïü (ÈÄæÊôÇ15ÁßíËá™ÂãïÂà§ÂÆö)" : "Ëá™ÂãïÊìäÊÆ∫Â∑≤ÈóúÈñâ"}
                                >
                                    <Bot size={14} />
                                </button>

                                <button
                                    onClick={() => setIsSoundEnabled(!isSoundEnabled)}
                                    className={`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold transition-all border ${
                                        isSoundEnabled 
                                        ? 'bg-slate-700 text-green-400 border-green-500/30' 
                                        : 'bg-slate-800 text-slate-500 border-transparent'
                                    }`}
                                    title={isSoundEnabled ? "Èü≥ÊïàÊèêÁ§∫Â∑≤ÈñãÂïü (3ÂàÜÈêòÂâç)" : "Èü≥ÊïàÊèêÁ§∫Â∑≤ÈóúÈñâ"}
                                >
                                    {isSoundEnabled ? <Volume2 size={14} /> : <VolumeX size={14} />}
                                </button>

                                <button
                                    onClick={() => updateEventMode(!isEventMode)}
                                    className={`flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold transition-all border w-full md:w-auto justify-center ${
                                        isEventMode 
                                        ? 'bg-amber-500/10 border-amber-500 text-amber-500 shadow-[0_0_10px_rgba(245,158,11,0.2)]' 
                                        : 'bg-slate-800 border-slate-700 text-slate-400'
                                    }`}
                                >
                                    <Zap size={14} className={isEventMode ? 'fill-amber-500' : ''} />
                                    {isEventMode ? 'Ê¥ªÂãïÊúüÈñì' : '‰∏ÄËà¨ÊúüÈñì'}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 py-6">
                        {/* Recent Activity Bar */}
                        {recentBosses.length > 0 && (
                            <div className="mb-8 animate-[fadeIn_0.5s]">
                                <div className="flex items-center gap-2 mb-3 px-1">
                                    <History size={18} className="text-indigo-400" />
                                    <h2 className="text-sm font-bold text-slate-300">ÊúÄËøëÂãïÊÖãËàá‰øÆÊ≠£</h2>
                                    <div className="flex-1"></div>
                                    <button 
                                        onClick={handleIgnoreAllRecent}
                                        className="text-[10px] bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-400 px-2 py-1 rounded flex items-center gap-1 transition"
                                    >
                                        <X size={10} /> ÂÖ®ÈÉ®ÂøΩÁï•
                                    </button>
                                </div>
                                <div className="flex gap-3 overflow-x-auto pb-4 no-scrollbar snap-x">
                                    {recentBosses.map(boss => {
                                        const isSpawned = boss.nextSpawn && boss.nextSpawn <= currentTime;
                                        return (
                                            <div key={boss.id} className={`snap-start min-w-[200px] bg-slate-800 rounded-lg p-3 border shadow-lg flex flex-col justify-between ${isSpawned ? 'border-green-500/50' : 'border-slate-600'}`}>
                                                <div className="flex items-center gap-2 mb-2">
                                                    <span className="text-xl">{boss.image}</span>
                                                    <div className="overflow-hidden">
                                                        <div className="font-bold text-sm text-slate-200 truncate">{boss.name}</div>
                                                        <div className={`text-[10px] font-bold ${isSpawned ? 'text-green-400' : 'text-slate-400'}`}>
                                                            {isSpawned ? 'üü¢ Â∑≤ÈáçÁîü' : 'üî¥ ÂâõÊìäÊÆ∫ (Ëá™Âãï)'}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="mt-auto flex flex-col gap-2">
                                                    {!isSpawned && (
                                                        <div className="relative">
                                                            <input 
                                                                type="text" 
                                                                placeholder="‰øÆÊ≠£ (123010)"
                                                                maxLength={6}
                                                                inputMode="numeric"
                                                                className="w-full bg-slate-900 border border-slate-700 rounded py-1 px-2 text-xs text-center focus:border-indigo-500 focus:outline-none"
                                                                onKeyDown={(e) => handleQuickTimeInput(boss.id, e)}
                                                                onBlur={(e) => handleQuickTimeInput(boss.id, e)}
                                                            />
                                                            <div className="text-[9px] text-slate-500 text-center mt-1">‰∏äÊ¨°: {formatAbsTime(boss.lastKill)}</div>
                                                        </div>
                                                    )}
                                                    
                                                    <div className="flex gap-1">
                                                        <button
                                                            onClick={() => handleKill(boss.id)}
                                                            className={`flex-1 border rounded py-1 text-xs font-bold transition flex items-center justify-center gap-1 ${
                                                                isSpawned 
                                                                ? 'bg-green-600/20 hover:bg-green-600/40 text-green-300 border-green-500/30' 
                                                                : 'bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600'
                                                            }`}
                                                            title={isSpawned ? "Á¢∫Ë™çÊìäÊÆ∫" : "Êõ¥Êñ∞ÊìäÊÆ∫ÊôÇÈñìÁÇ∫ÁèæÂú®"}
                                                        >
                                                            <Skull size={12}/> {isSpawned ? 'ÊìäÊÆ∫' : 'ÈáçÊÆ∫'}
                                                        </button>
                                                        <button 
                                                            onClick={() => handleIgnoreRecent(boss)}
                                                            className="flex-1 bg-slate-700 hover:bg-slate-600 border border-slate-600 text-slate-400 hover:text-slate-300 rounded py-1 text-xs font-bold transition flex items-center justify-center gap-1"
                                                            title="ÂæûÊ≠§Ê¨Ñ‰ΩçÁßªÈô§ (‰∏çÂΩ±ÈüøË®àÊôÇ)"
                                                        >
                                                            <X size={12}/> ÂøΩÁï•
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                            {sortedBosses.map(boss => {
                                const timeLeft = boss.nextSpawn ? boss.nextSpawn - currentTime : null;
                                const isSpawned = timeLeft !== null && timeLeft <= 0;
                                const isSoon = timeLeft !== null && timeLeft > 0 && timeLeft < 10 * 60 * 1000;
                                const isVerySoon = timeLeft !== null && timeLeft > 0 && timeLeft <= 3 * 60 * 1000;
                                const currentInterval = getInterval(boss);

                                let statusColor = "border-slate-700 bg-slate-800";
                                if (isSpawned) statusColor = "border-green-500 bg-slate-800 shadow-[0_0_15px_rgba(34,197,94,0.3)] order-first";
                                else if (isVerySoon) statusColor = "border-orange-500 bg-slate-800 shadow-[0_0_15px_rgba(249,115,22,0.3)] animate-pulse-slow";
                                else if (isSoon) statusColor = "border-yellow-500 bg-slate-800 shadow-[0_0_10px_rgba(234,179,8,0.2)]";

                                return (
                                    <div key={boss.id} className={`relative rounded-xl border-2 p-4 transition-all duration-300 ${statusColor}`}>
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex items-center gap-3">
                                                <div className="text-2xl bg-slate-700 w-10 h-10 flex items-center justify-center rounded-full shadow-inner">
                                                    {boss.image}
                                                </div>
                                                <div className="overflow-hidden">
                                                    <h3 className="font-bold text-base text-slate-100 truncate">{boss.name}</h3>
                                                    <div className="flex items-center gap-2 text-[10px] text-slate-400">
                                                        <span className={`px-1.5 py-0.5 rounded ${
                                                            boss.race === 'Elyos' ? 'bg-sky-900/50 text-sky-300' : 
                                                            boss.race === 'Asmodian' ? 'bg-red-900/50 text-red-300' : 
                                                            'bg-purple-900/50 text-purple-300'
                                                        }`}>
                                                            {boss.race === 'Elyos' ? 'Â§©' : boss.race === 'Asmodian' ? 'È≠î' : 'Ê∑±'}
                                                        </span>
                                                        <span className="truncate">üìç{boss.location}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <button onClick={() => openModal(boss)} className="p-1 text-slate-500 hover:text-indigo-400">
                                                    <Edit2 size={14} />
                                                </button>
                                                <button onClick={() => handleDelete(boss.id)} className="p-1 text-slate-500 hover:text-red-400">
                                                    <Trash2 size={14} />
                                                </button>
                                            </div>
                                        </div>

                                        <div className="mb-4 bg-slate-900/50 rounded-lg p-2 text-center border border-slate-700/50 relative overflow-hidden">
                                            <div className="absolute top-1 right-2 text-[10px] text-slate-600 font-mono">
                                                {currentInterval}m
                                            </div>

                                            {boss.nextSpawn ? (
                                                <>
                                                    <div className={`text-xl font-mono font-bold tracking-wider my-1 ${
                                                        isSpawned ? 'text-green-400 animate-pulse' : 
                                                        isVerySoon ? 'text-orange-400 animate-bounce' : 
                                                        isSoon ? 'text-yellow-400' : 'text-slate-200'
                                                    }`}>
                                                        {formatTime(timeLeft)}
                                                    </div>
                                                    <div className="flex justify-between px-4 text-[10px] text-slate-500 border-t border-slate-800 pt-1 mt-1">
                                                        <span>‰∏äÊ¨°: {formatAbsTime(boss.lastKill)}</span>
                                                        <span>‰∏ãÊ¨°: {formatAbsTime(boss.nextSpawn)}</span>
                                                    </div>
                                                </>
                                            ) : (
                                                <div className="text-slate-500 py-3 flex flex-col items-center">
                                                    <div className="flex items-center gap-1 text-xs opacity-60">
                                                        <Clock size={12}/> ÈáçÁîü: {currentInterval} ÂàÜ
                                                    </div>
                                                    <span className="text-[10px] mt-1">Á≠âÂæÖÊìäÊÆ∫</span>
                                                </div>
                                            )}
                                        </div>

                                        <div className="grid grid-cols-[1fr,auto] gap-2">
                                            <button 
                                                onClick={() => handleKill(boss.id)}
                                                className={`h-9 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all text-sm
                                                    ${isSpawned 
                                                        ? 'bg-gradient-to-r from-green-600 to-green-500 text-white shadow-green-900/20' 
                                                        : 'bg-gradient-to-r from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500 text-slate-200'
                                                    }`}
                                            >
                                                <Skull size={16} />
                                                {isSpawned ? "Á¢∫Ë™çÊìäÊÆ∫" : "ÂâõÊâçÊìäÊÆ∫"}
                                            </button>
                                            
                                            <div className="relative group">
                                                <input 
                                                    type="text" 
                                                    placeholder="123010"
                                                    maxLength={6}
                                                    inputMode="numeric"
                                                    className="h-9 w-[80px] bg-slate-900 border border-slate-700 rounded-lg px-2 text-xs text-slate-300 focus:border-indigo-500 outline-none text-center"
                                                    onKeyDown={(e) => handleQuickTimeInput(boss.id, e)}
                                                    onBlur={(e) => handleQuickTimeInput(boss.id, e)}
                                                />
                                                <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none z-10 whitespace-nowrap">
                                                    1230=12:30 / 123010=12:30:10
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {boss.nextSpawn && (
                                            <button 
                                                onClick={() => handleReset(boss.id)}
                                                className="absolute bottom-4 right-4 translate-y-full opacity-0 hover:opacity-100 text-slate-600 hover:text-slate-400 transition text-[10px] flex items-center gap-1 mt-1"
                                            >
                                                <RotateCcw size={10} /> ÈáçÁΩÆ
                                            </button>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                        
                        {filteredBosses.length === 0 && (
                            <div className="text-center py-20 text-slate-500">
                                <Filter size={48} className="mx-auto mb-4 opacity-20" />
                                <p>Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑ BOSS</p>
                                {searchQuery && <p className="text-xs text-slate-600 mt-2">ÈóúÈçµÂ≠ó: {searchQuery}</p>}
                                <button onClick={() => {selectAllRaces(); setSearchQuery('');}} className="text-indigo-400 hover:underline mt-2">È°ØÁ§∫ÂÖ®ÈÉ®</button>
                            </div>
                        )}
                    </main>

                    {/* Confirmation Modal */}
                    {confirmModal.isOpen && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-xl shadow-2xl w-full max-w-sm border border-slate-700 animate-in fade-in zoom-in duration-200 p-6">
                                <div className="flex flex-col items-center text-center gap-4">
                                    <div className="w-12 h-12 bg-slate-700 rounded-full flex items-center justify-center text-yellow-500">
                                        <AlertTriangle size={28} />
                                    </div>
                                    <h3 className="text-lg font-bold text-white whitespace-pre-line leading-relaxed">
                                        {confirmModal.message}
                                    </h3>
                                    
                                    <div className="flex w-full gap-3 mt-2">
                                        {confirmModal.type === 'confirm' && (
                                            <>
                                            <button 
                                                onClick={() => setConfirmModal({ ...confirmModal, isOpen: false })}
                                                className="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-200 py-2.5 rounded-lg font-medium transition"
                                            >
                                                ÂèñÊ∂à
                                            </button>
                                            <button 
                                                onClick={() => {
                                                    if (confirmModal.onConfirm) confirmModal.onConfirm();
                                                    setConfirmModal({ ...confirmModal, isOpen: false });
                                                }}
                                                className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-lg font-bold shadow-lg transition"
                                            >
                                                Á¢∫Ë™ç
                                            </button>
                                            </>
                                        )}
                                        {confirmModal.type === 'alert' && (
                                            <button 
                                                onClick={() => setConfirmModal({ ...confirmModal, isOpen: false })}
                                                className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-lg font-bold shadow-lg transition"
                                            >
                                                ÈóúÈñâ
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit/Add Modal */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 rounded-xl shadow-2xl w-full max-w-md border border-slate-700 animate-in fade-in zoom-in duration-200">
                                <div className="flex justify-between items-center p-5 border-b border-slate-700">
                                    <h2 className="text-xl font-bold text-white">
                                        {editingBoss ? 'Á∑®ËºØ BOSS' : 'Êñ∞Â¢û BOSS'}
                                    </h2>
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-400 hover:text-white transition">
                                        <X size={24} />
                                    </button>
                                </div>
                                
                                <form onSubmit={handleSaveBoss} className="p-5 space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="col-span-2">
                                            <label className="block text-xs text-slate-400 mb-1">ÊâÄÂ±¨Á®ÆÊóè</label>
                                            <div className="flex bg-slate-900 p-1 rounded-lg">
                                                {['Elyos', 'Asmodian', 'Abyss'].map(r => (
                                                    <button
                                                        key={r}
                                                        type="button"
                                                        onClick={() => setFormData({...formData, race: r})}
                                                        className={`flex-1 py-1.5 text-xs rounded-md transition ${formData.race === r ? 'bg-slate-700 text-white font-bold' : 'text-slate-500 hover:text-slate-300'}`}
                                                    >
                                                        {r === 'Elyos' ? 'Â§©Êóè' : r === 'Asmodian' ? 'È≠îÊóè' : 'Ê∑±Ê∑µ'}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="col-span-2">
                                            <label className="block text-xs text-slate-400 mb-1">BOSS ÂêçÁ®±</label>
                                            <input 
                                                required
                                                type="text" 
                                                value={formData.name}
                                                onChange={e => setFormData({...formData, name: e.target.value})}
                                                className="w-full bg-slate-900 border border-slate-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                            />
                                        </div>

                                        <div className="col-span-2">
                                            <label className="block text-xs text-slate-400 mb-1">Âá∫Ê≤íÂú∞Èªû</label>
                                            <input 
                                                type="text" 
                                                value={formData.location}
                                                onChange={e => setFormData({...formData, location: e.target.value})}
                                                className="w-full bg-slate-900 border border-slate-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-xs text-slate-400 mb-1">‰∏ÄËà¨ÊôÇÈñì (ÂàÜ)</label>
                                            <input 
                                                required type="number" min="1"
                                                value={formData.intervalNormal}
                                                onChange={e => setFormData({...formData, intervalNormal: parseInt(e.target.value) || 0})}
                                                className="w-full bg-slate-900 border border-slate-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs text-amber-500/80 mb-1">Ê¥ªÂãïÊôÇÈñì (ÂàÜ)</label>
                                            <input 
                                                required type="number" min="1"
                                                value={formData.intervalEvent}
                                                onChange={e => setFormData({...formData, intervalEvent: parseInt(e.target.value) || 0})}
                                                className="w-full bg-slate-900 border border-slate-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-xs text-slate-400 mb-1">ÂúñÁ§∫</label>
                                        <div className="flex gap-2 overflow-x-auto pb-2">
                                            {['üê∫', 'üßü', 'üå∫', 'üõ°Ô∏è', '‚öîÔ∏è', 'üîÆ', 'ü¶∑', 'üò°', 'üìú', 'üèÉ', 'üå≥', 'ü¶ë', 'üë∫', 'üëÆ', '‚ú®', 'üò∂', 'üëª', 'üåæ', 'üëÅÔ∏è', 'üß™', 'ü¶ã', 'üëë', 'üèùÔ∏è'].map(emoji => (
                                                <button
                                                    key={emoji}
                                                    type="button"
                                                    onClick={() => setFormData({...formData, image: emoji})}
                                                    className={`min-w-[40px] h-10 rounded-lg flex items-center justify-center text-xl transition ${formData.image === emoji ? 'bg-indigo-600 text-white scale-110' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}
                                                >
                                                    {emoji}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="pt-2 flex gap-3">
                                        <button 
                                            type="button"
                                            onClick={() => setIsModalOpen(false)}
                                            className="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-medium transition"
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                        <button 
                                            type="submit"
                                            className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition"
                                        >
                                            <Save size={18} />
                                            ÂÑ≤Â≠ò
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
